(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8995],{38995:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return CardanoExample}});var i=n(15861),s=n(86854),r=n(67294),a=n(10366),d=n(57069);let ProviderCardanoBase=class ProviderCardanoBase extends d.BX{constructor(e){super(e),this.providerName=a.U.cardano}request(e){return this.bridgeRequest(e)}};var o=n(22519),__awaiter=function(e,t,n,i){return new(n||(n=Promise))(function(s,r){function fulfilled(e){try{step(i.next(e))}catch(e){r(e)}}function rejected(e){try{step(i.throw(e))}catch(e){r(e)}}function step(e){var t;e.done?s(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(fulfilled,rejected)}step((i=i.apply(e,t||[])).next())})};let ProviderCardano=class ProviderCardano extends ProviderCardanoBase{constructor(e){super(Object.assign(Object.assign({},e),{bridge:e.bridge||(0,o.R)({timeout:e.timeout})})),this._account=null,this._registerEvents(),this.nami=Object.assign(Object.assign({},this.walletInfo()),{name:"Nami"}),this.onekey=Object.assign({},this.walletInfo())}get account(){return this._account}get isConnected(){return null!==this._account}_registerEvents(){window.addEventListener("onekey_bridge_disconnect",()=>{this._handleDisconnected()}),this.on("message_low_level",e=>{var t;let{method:n,params:i}=e;t="accountChanged",(n===`metamask_${t}`||n===`wallet_events_${t}`)&&this._handleAccountChange(i)})}_callBridge(e){return this.bridgeRequest(e)}postMessage(e){return this._callBridge(e)}_handleConnected(e,t){this._account=e,t.emit&&this.isConnectionStatusChanged("connected")&&(this.connectionStatus="connected",this.emit("connect",e),this.emit("accountChanged",e))}_handleDisconnected(e={emit:!0}){e.emit&&this.isConnectionStatusChanged("disconnected")&&(this.connectionStatus="disconnected",this.emit("disconnect"),this.emit("accountChanged",null))}isAccountsChanged(e){return e!==this._account}_handleAccountChange(e){let t=e.accounts.address;if(this.isAccountsChanged(t)&&this.emit("accountChanged",t||null),!t){this._handleDisconnected();return}t&&this._handleConnected(t,{emit:!1})}on(e,t){return super.on(e,t)}emit(e,...t){return super.emit(e,...t)}walletInfo(){return{apiVersion:"0.1.0",name:"OneKey",icon:"https://theme.zdassets.com/theme_assets/10237731/cd8f795ce97bdd7657dd4fb4b19fde3f32b50349.png",isEnabled:()=>Promise.resolve(!0),enable:()=>this.enable()}}enable(){return __awaiter(this,void 0,void 0,function*(){let e={getNetworkId:()=>this.getNetworkId(),getUtxos:(e,t)=>this.getUtxos(e,t),getCollateral:()=>this.getCollateral(),getBalance:()=>this.getBalance(),getUsedAddresses:()=>this.getUsedAddresses(),getUnusedAddresses:()=>this.getUnUsedAddress(),getChangeAddress:()=>this.getChangeAddress(),getRewardAddresses:()=>this.getRewardAddresses(),signTx:(e,t)=>this.signTx(e,t),signData:(e,t)=>this.signData(e,t),submitTx:e=>this.submitTx(e),experimental:{on:(e,t)=>this.namiOn(e,t),off:()=>this.namiOff(),getCollateral:()=>this.getCollateral()}};if(!this.account){let t=yield this._callBridge({method:"connect",params:void 0});return this._handleConnected(t.account,{emit:!0}),e}return Promise.resolve(e)})}getNetworkId(){return __awaiter(this,void 0,void 0,function*(){return this._callBridge({method:"getNetworkId",params:void 0})})}getUtxos(e,t){return __awaiter(this,void 0,void 0,function*(){return this._callBridge({method:"getUtxos",params:{amount:e,paginate:t}})})}getCollateral(){return __awaiter(this,void 0,void 0,function*(){return Promise.resolve(null)})}getBalance(){return __awaiter(this,void 0,void 0,function*(){return this._callBridge({method:"getBalance",params:void 0})})}getUsedAddresses(){return __awaiter(this,void 0,void 0,function*(){return this._callBridge({method:"getUsedAddresses",params:void 0})})}getUnUsedAddress(){return __awaiter(this,void 0,void 0,function*(){return this._callBridge({method:"getUnusedAddresses",params:void 0})})}getChangeAddress(){return __awaiter(this,void 0,void 0,function*(){return this._callBridge({method:"getChangeAddress",params:void 0})})}getRewardAddresses(){return __awaiter(this,void 0,void 0,function*(){return this._callBridge({method:"getRewardAddresses",params:void 0})})}signTx(e,t){return __awaiter(this,void 0,void 0,function*(){return this._callBridge({method:"signTx",params:{tx:e,partialSign:t}})})}signData(e,t){return __awaiter(this,void 0,void 0,function*(){return this._callBridge({method:"signData",params:{addr:e,payload:t}})})}submitTx(e){return __awaiter(this,void 0,void 0,function*(){return this._callBridge({method:"submitTx",params:e})})}namiOn(e,t){let handler=e=>t(e.detail),n=window.cardano.nami._events[e]||[];window.cardano.nami._events[e]=[...n,[t,handler]],window.addEventListener(`nami-wallet${e}`,handler)}namiOff(){}};var c=[{name:"Minswap",url:"https://app.minswap.org/"},{name:"SundaeSwap",url:"https://sundaeswap.finance/"}],l=n(6424),u=n(85893),h=n(48764).Buffer,useProvider=function(){var e=(0,r.useState)(),t=(0,s.Z)(e,2),n=t[0],i=t[1];return(0,r.useEffect)(function(){i(window.cardano||new ProviderCardano({}))},[]),n};function CardanoExample(){var e,t,n,a=useProvider(),d=(0,r.useState)(!1),o=(0,s.Z)(d,2),g=o[0],f=o[1],_=(0,r.useState)(null),m=(0,s.Z)(_,2),v=m[0],p=m[1],w=(0,r.useState)(null),x=(0,s.Z)(w,2),b=x[0],j=x[1],C=(0,r.useState)([]),y=(0,s.Z)(C,2),A=y[0],k=y[1],B=(0,r.useState)([]),O=(0,s.Z)(B,2),S=O[0],E=O[1],I=(0,r.useState)([]),U=(0,s.Z)(I,2),Z=U[0],N=U[1],P=(0,r.useState)(""),T=(0,s.Z)(P,2),D=T[0],H=T[1],L=(0,r.useState)([]),R=(0,s.Z)(L,2),V=R[0],X=R[1],J=(0,r.useState)(""),K=(0,s.Z)(J,2),M=K[0],W=K[1],$=(0,r.useCallback)((0,i.Z)(function*(){var e=yield a.onekey.enable();try{e.getNetworkId().then(function(e){return j(e)}),e.getUtxos().then(function(e){return k(e)}),e.getBalance().then(function(e){return W(e)}),e.getUsedAddresses().then(function(e){return E(e)}),e.getUnusedAddresses().then(function(e){return N(e)}),e.getRewardAddresses().then(function(e){return X(e)}),e.getChangeAddress().then(function(e){return H(e)})}catch(e){}}),[a]);(0,r.useEffect)(function(){if(a){try{a.on("connect",function(e){console.log("cardanoWallet.on [connect] ".concat(e)),$().catch(function(e){return console.error(e)})})}catch(e){console.error(e)}try{a.on("accountChanged",function(e){console.log("cardanoWallet.on [accountChange] ".concat(e)),$().catch(function(e){return console.error(e)})})}catch(e){console.error(e)}return function(){}}},[a,$]);var q=(e=(0,i.Z)(function*(){try{var e=yield a.onekey.enable();p(e),f(!0)}catch(e){console.error(e),p(null),f(!1)}}),function(){return e.apply(this,arguments)}),G=(t=(0,i.Z)(function*(){console.log((yield v.signTx("84a300818258200528ed5dd2134534df4d999c9cd712e8b47441a0363cc972bf5d5c72635c3e5100018282583901cd5aa28518568615ed6bd4ad40e6cecd65734373bf578489b02830e38d6dc22f3b6dfd333cf6495e8fb3fffbc2936cc010827b32d92eca1b1a000f424082583901922941c2e490c9f9f8706c66f7f46b5abec243fcb663f02817fb9b83aa618af8973bc5f1fdb9c9db97d1c55f0d4d4a1e633bbb14ab43b4fc1a001449d5021a00029075a0f5f6",!0)))}),function(){return t.apply(this,arguments)}),z=(n=(0,i.Z)(function*(){console.log((yield v.signData(null==S?void 0:S[0],h.from("hello world","utf8").toString("hex"))))}),function(){return n.apply(this,arguments)});return(0,u.jsxs)("div",{children:[(0,u.jsx)(l.p,{dapps:c}),(0,u.jsx)("div",{style:{padding:"20px"},children:"Cardano 返回数据格式大部分为 CBOR 的包装格式，需要对应 SDK 解析。由于本项目不引入第三方 SDK, 所以示例项目直接展示原始字符串"}),!a&&(0,u.jsx)("a",{target:"_blank",href:"https://www.onekey.so/download/",children:"Install OneKey Extension →"}),(0,u.jsx)("main",{children:a&&g?(0,u.jsxs)("div",{children:[(0,u.jsxs)("ul",{children:["walletName: ",(0,u.jsx)("img",{src:a.onekey.icon,style:{height:"24px",width:"24px"}})," ",a.onekey.name]}),(0,u.jsxs)("ul",{children:["apiVersion: ",a.onekey.apiVersion]}),(0,u.jsxs)("ul",{children:["networkId: ",b]}),(0,u.jsxs)("ul",{style:{width:"80%"},children:["Utxos: ",A.map(function(e){return(0,u.jsx)("li",{style:{overflow:"hidden",textOverflow:"ellipsis"},children:e},e)})]}),(0,u.jsxs)("ul",{children:["balance: ",M]}),(0,u.jsxs)("ul",{style:{width:"80%"},children:["UsedAddresses: ",S.map(function(e){return(0,u.jsx)("li",{style:{overflow:"hidden",textOverflow:"ellipsis"},children:e},e)})]}),(0,u.jsxs)("ul",{style:{width:"80%"},children:["UnusedAddresses: ",Z.map(function(e){return(0,u.jsx)("li",{style:{overflow:"hidden",textOverflow:"ellipsis"},children:e},e)})]}),(0,u.jsxs)("ul",{style:{width:"80%"},children:["rewardAddresses: ",V.map(function(e){return(0,u.jsx)("li",{style:{overflow:"hidden",textOverflow:"ellipsis"},children:e},e)})]}),(0,u.jsxs)("ul",{children:["changeAddress: ",D]}),(0,u.jsx)("button",{onClick:function(){return G()},children:"SignTransaction"}),(0,u.jsx)("button",{onClick:function(){return z()},children:"SignData"})]}):(0,u.jsx)("button",{onClick:function(){return q()},children:"Connect Wallet"})})]})}},6424:function(e,t,n){"use strict";n.d(t,{p:function(){return DAppList}}),n(67294);var i=n(36612),s=n.n(i),r=n(85893);function DAppList(e){var t=e.dapps;return(0,r.jsxs)("div",{className:s().container,children:[(0,r.jsx)("h3",{children:"Top DApps"}),(0,r.jsx)("ul",{children:t.map(function(e){return(0,r.jsx)("li",{children:(0,r.jsxs)("a",{href:e.url,target:"_blank",children:[e.name," ↗"]})},e.name)})})]})}},36612:function(e){e.exports={container:"Home_container__d256j",main:"Home_main__VkIEL",footer:"Home_footer__yFiaX",title:"Home_title__hYX6j",description:"Home_description__uXNdx",code:"Home_code__VVrIr",grid:"Home_grid__AVljO",card:"Home_card__E5spL",logo:"Home_logo__IOQAX"}},22519:function(e,t,n){"use strict";n.d(t,{R:function(){return getOrCreateExtInjectedJsBridge}});var i=n(57069);let{JS_BRIDGE_MESSAGE_DIRECTION:s,JS_BRIDGE_MESSAGE_EXT_CHANNEL:r}=i.consts;function getOrCreateExtInjectedJsBridge(e={}){let t=(0,i.Pk)(()=>new JsBridgeExtInjected(Object.assign(Object.assign({},e),{receiveHandler:i.gZ})));return t}let a=!1;let JsBridgeExtInjected=class JsBridgeExtInjected extends i.ZN{constructor(e){super(e),this.sendAsString=!1,this.isInjected=!0,function(e={}){let t=e.debugLogger||i.go;a||(a=!0,window.addEventListener("message",n=>{var i,a;if(n.source!==window)return;let d=n.data;if(d.channel===r&&d.direction===s.HOST_TO_INPAGE){t.extInjected("onWindowPostMessage",d);let n=d.payload,s=null!==(i=e.bridge)&&void 0!==i?i:null===(a=null==window?void 0:window.$onekey)||void 0===a?void 0:a.jsBridge;s&&s.receive(n)}},!1))}({debugLogger:this.debugLogger,bridge:this})}sendPayload(e){window.postMessage({channel:r,direction:s.INPAGE_TO_HOST,payload:e})}}}}]);
//# sourceMappingURL=8995.832dd8e013c9a823.js.map